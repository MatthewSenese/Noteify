<!DOCTYPE html>
    <html lang = 'en'>
    <!-- Matthew Senese, Matthew O'Malley, Jon Rayo -->

    <head>
        <meta charset = 'UTF-8'>
        <title>Noteify</title>
        <link rel = "stylesheet" href = "index.css">
        <link rel="icon" type="image/x-icon" href="./icons/fav.PNG">
        <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js"></script>
        <meta name = "viewport" content = "width = device-width, initial-scale = 1.0">

    </head>

    <input style = "position: absolute; top: 10px; left: 10px; width: auto;
    font-family: fire; background-color: transparent; border: none; outline: none;" 
    class = "loggedIn" type = "text" id = "loggedInAs" readonly size = "40">

    <script>

        // Declare set count and main array so they are available in entire script
        var setCount = 0
        var mainArray = new Array()
        
        // Functions that activate upon page load
        window.onload = function() {
        welcMsg(); 
        getNotes();
        };

        // Welcome appears if user is logged in
        async function welcMsg() {

            const fetchString = "/islogged?"
            const response = await fetch(fetchString)
            const responseText = await response.text()

            document.getElementById('loggedInAs').value = "Welcome, " + responseText
            document.getElementById('loggedInAs').className = "hideIt";

            if (responseText.length > 6) {
                document.getElementById('loggedInAs').className = "show";
            }
        }

        // Function that changes the value of the page counter
        function currNote() {
            
            // Logic done here that will determine which page it is on, and how many there are
            document.getElementById('oneOfTag').value = "1" + " / " + String(setNumber);
        }

        // Changes note to the note prior in the list
        function noteForward() {

            // Increment note number
            setCount ++
            
            // Reset fields with new note
            document.getElementById("titleOutput").value = (mainArray[setCount][0])
            document.getElementById("noteOutput").value = (mainArray[setCount][1])

        }

        // Changes note to the next one in the list
        function noteBackward() {
            
            // Decrement note number
            setCount --
            
            // Reset fields with new note
            document.getElementById("titleOutput").value = (mainArray[setCount][0])
            document.getElementById("noteOutput").value = (mainArray[setCount][1])
        }

        // Function to recieve notes from server
        async function getNotes() {

            // Make a request to the server for the note data
            const fetchString = "/getNotes"
            const response = await fetch(fetchString)
            const responseText = await response.text()

            // First, split the result to make it an object
            var data = responseText.split(",")
            
            // iterate through each title note pair and strip them
            for (var set of data) {
                // ugly string parsing (please ignore) might clean up later
                var theTitle = set.substr(0, set.indexOf(':'));
                var theNote = set.substr(set.indexOf(':') + 1);
                var theTitle = theTitle.split(/[{"]+/)
                var theNote = theNote.split(/[{}:"]+/)
                var theNote = theNote.slice(2, -1)
                var theTitle = theTitle.slice(1, -1)

                // push subarray to mainArray
                mainArray.push([theTitle, theNote])
            }

            // If there is no note data, alert user and redirect them to noteify page
            if (responseText.length < 1) {
                alert("You have no notes! Redirecting to Noteify page...")
                location.href = 'https://noteify.azurewebsites.net/noteify/'
            } else {
                // Set each field value to it's associated array value in main array
                document.getElementById("titleOutput").value = (mainArray[setCount][0])
                document.getElementById("noteOutput").value = (mainArray[setCount][1])
            }
        }

    </script>

    <!-- Navigation Bar -->
    <ul class = "navbar">
        <li><a href="https://noteify.azurewebsites.net/"><img style = "padding-right: 5px;" src = "./icons/home.png" 
            alt = "homeIcon" class = "icon"><span style = "font-size: 14px">Home</span></a></li>
        <li><a href="https://noteify.azurewebsites.net/login"><img style = "padding-right: 5px;" src = "./icons/login.png" 
            alt = "loginIcon" class = "icon"><span style = "font-size: 14px">Login</span></a></li></a></li>
        <li><a href="https://noteify.azurewebsites.net/logout"><img style = "padding-right: 5px;" src = "./icons/logout.png" 
            alt = "logoutIcon" class = "icon"><span style = "font-size: 14px">Logout</span></a></li></a></li>
        <li><a href="https://noteify.azurewebsites.net/noteify"><img style = "padding-right: 5px;" src = "./icons/noteify.png" 
            alt = "noteifyIcon" class = "icon"><span style = "font-size: 14px">Noteify</span></a></li></a></li>
        <li style = "background-color: rgb(222, 222, 222); padding-top: 10px; padding-bottom: 10px; border-radius: 10px;"><a href="https://noteify.azurewebsites.net/notes">
            <img style = "padding-right: 5px;" src = "./icons/view.png" alt = "viewIcon" class = "icon"><span style = "font-size: 14px">View</span></a></li></a></li>
        <li class = "hideIt"><a href="https://noteify.azurewebsites.net/projectProposal"><img style = "padding-right: 5px;" src  = "./icons/about.png" 
            alt = "aboutIcon" class = "icon"><span style = "font-size: 14px">About</span></a></li></a></li>
    </ul>

    <!-- Header -->
    <body>
        <h1 class = "toptitle">Noteify</h1>
        <p class = "topsubtitle">Start Taking Note</p>

    <div class = "mainbody">
        <h2 style = "margin-top: 0; font-family: lato;">My Notes</h2>
        <p class = "bodytext">Welcome to the view page! Here, you can view, edit, and delete all your previously saved notes!
            Click "View" to begin.
        </p><br>


    <!-- location bar at the bottom of the page -->
    <div style = "position: relative; text-align: center">
        <a href = "https://noteify.azurewebsites.net/noteify">
        <p class = "bottomnav"><span style = "border-radius: 10px; padding: 1px; border-width: 1px;
        background-color: rgb(233, 233, 233); border-style: solid;">&nbsp;www.noteify.com/notes&nbsp;</span></p></a>
    </div>

    <!-- Textbox for Title line -->
    <textarea readonly style = "line-height: 10px; resize: none textarea; height: 1em;" class = "textBox" id = "titleOutput" name = "titleOutput"
    rows = "1" cols = "25" wrap = "physical" maxlength = "30"></textarea><br><br>

    <!-- Textbox for user input -->
    <textarea readonly class = "textBox" id = "noteOutput" name = "textInput" rows = "6" cols = "40" wrap = "physical" 
    maxlength = "300"></textarea>
    

    <!-- Div styling for options buttons -->
    <div class = "buttonRow">
        <!-- Option buttons at the bottom of each note--> <br><br>
        <button class = "createButton" id = "editNoteID"  type = "button" onclick = "editNote()">Edit Note</button>
        <button class = "createButton" id = "deleteNoteID"  type = "button" onclick = "deleteNote()">Delete Note</button>
    </div><br><br>

    <!-- Navigation arrows for notes that increment or decrement note value -->
    <img class = "arrows" src = "./icons/arrowb.png" alt = "backArrow" onclick = "noteBackward();currNote()">
    <textarea style = "height: 1.5em;" rows = "1" cols = "4" id = "oneOfTag" class = "oneOf" readonly size = "5">1 / 1</textarea>
    <img class = "arrows" src = "./icons/arrowf.png" alt = "forwArrow" onclick = "noteForward();currNote()">

    <div id ="root"></div>
    <script>
    var firebaseConfig = {
        apiKey: "AIzaSyBQZNSXZK1EVIoez75smdeqEgS3yu3rwi0",
        authDomain: "noteify-d7193.firebaseapp.com",
        databaseURL: "https://noteify-d7193-default-rtdb.firebaseio.com",
        projectId: "noteify-d7193",
        storageBucket: "noteify-d7193.appspot.com",
        messagingSenderId: "259103554370",
        appId: "1:259103554370:web:bb31e247835601343266db",
        measurementId: "G-DXJET6RER1"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
var firebaseRef = firebase.database().ref("uk8FjYIV53Y8huMN7huGMhb7kGA2")
firebaseRef.on("value", function(snapshot) {
    snapshot.forEach(function(element) {
        document.querySelector('#root').innerHTML +=
        <div>${element.val()}</div>
    });
})
   

</script>
    </body>

    </html>