<!DOCTYPE html>
    <html lang = 'en'>
    <!-- Matthew Senese, Matthew O'Malley, Jon Rayo -->

    <head>
        <meta charset = 'UTF-8'>
        <title>Noteify</title>
        <link rel = "stylesheet" href = "index.css">
        <meta name = "viewport" content = "width = device-width, initial-scale = 1.0">
    </head>

    <input style = "position: absolute; top: 10px; left: 10px; width: auto;
    font-family: fire; background-color: transparent; border: none" 
    class = "loggedIn" type = "text" id = "loggedInAs" readonly size = "30">

    <!-- Navigation bar to get back to home page -->
    <ul class="navbar">
        <li><a href="https://noteify.azurewebsites.net/">Home</a></li>
        <li><a href="https://noteify.azurewebsites.net/login">Login</a></li>
        <li><a href="https://noteify.azurewebsites.net/logout">Logout</a></li>
        <li><a href="https://noteify.azurewebsites.net/noteify">Noteify</a></li>
        <li><a href="https://noteify.azurewebsites.net/notes">Notes</a></li>
        <li><a href="https://noteify.azurewebsites.net/projectProposal">About</a></li>
    </ul>

    <!-- Script for functions -->
    <script>

        async function create() {
            // Collect variables
            const email = document.getElementById("email").value
            const password = document.getElementById("password").value
            const password2 = document.getElementById("password2").value
            expression = /^[^@]+@\w+(\.\w+)+\w$/

            // check if user is logged in, don't allow account creation if they are
            const fetchString = "/islogged?"
            const response = await fetch(fetchString)
            const responseText = await response.text()
            if (responseText == "NoLog") {

                if (email == "" || password == "" || password2 == "") {
                    alert("ERROR: Missing required field(s)")
                } else if (password != password2) {
                    alert("ERROR: Passwords must match")
                } else if (expression.test(email) == false) {
                    alert("ERROR: Enter an email")
                } else {
                    // Submit email and password to server
                    const fetchString = "/createAccount?email="+email+"&password="+password
                    const response = await fetch(fetchString)
                    const responseText = await response.text()

                    // if we get something back without an "@" symbol, it returned an error, so display it.
                    if (!responseText.includes("@")) {
                        alert(responseText)
                    // if we get something back, that means user creation and log in is successful, so reroute to noteify
                    } else {
                        alert("Account creation successful!\nClick OK to proceed.")
                        //location.href = 'http://localhost:8080/noteify';
                        location.href = 'https://noteify.azurewebsites.net/noteify/';
                    } 
                }  
            } else {
                // display error message if user tries to make an account while already logged in
                alert("You are already logged in!\n")
            }
        }

    </script>

    <script>

        // automatically call welcome message function upon page load
        window.onload = function() { welcMsg(); };

        // function that, if user is logged in, displays welcome message
        async function welcMsg() {

            const fetchString = "/islogged?"
            const response = await fetch(fetchString)
            const responseText = await response.text()
            
            document.getElementById('loggedInAs').value = "Welcome, " + responseText
            document.getElementById('loggedInAs').className = "hideIt";

            if (responseText.length > 6) {
                document.getElementById('loggedInAs').className = "show";
            }
        }

    </script>

    <!-- Header -->
    <body>
        <h1 class = "toptitle">Noteify</h1>
        <p class = "topsubtitle">Start Taking Note</p>
    
    <div class = "mainbody">
        <h2 style = "margin-top: 0;">Create Noteify Account</h2><br>

        <!-- Input boxes for username and password -->
        <h3>Enter your email: </h3>
        <div style = "margin-top: -1px; padding-bottom: 8px;">
            <form name = "usernameForm" class = "user-name" action="">
                <label class = "usernameBox" for = "email"></label>
                <input type = "text" id="email" placeholder = "Email" name = "email">            
        </div>

        <h3>Enter a password: </h3>
        <div style = "margin-top: -1px; padding-bottom: 8px;">
            <form name = "passwordForm" class = "pass-word" action="">
                <label class = "passwordBox" for = "password"></label>
                <input type = "text" id="password" placeholder = "Password" name = "password">            
        </div>

        <h3>Enter the same password: </h3>
        <div style = "margin-top: -1px; padding-bottom: 8px;">
            <form name = "passwordForm" class = "pass-word" action="">
                <label class = "passwordBox" for = "password2"></label>
                <input type = "text" id="password2" placeholder = "Repeat Password" name = "password2">            
        </div>
    </p>

    <button class = "submitButton" id = "createAccount" type = "button" onclick = "create()">Create Account</button><br>

    </body>

    <div style = "position: relative; text-align: center">
        <a href = "https://noteify.azurewebsites.net/login/createAccount">
        <p class = "bottomnav"><span style = "border-radius: 10px; padding: 1px; border-width: 1px;
        background-color: rgb(233, 233, 233); border-style: solid;">&nbsp;www.noteify.com/create&nbsp;</span></p></a>
    </div>
    
    </html>